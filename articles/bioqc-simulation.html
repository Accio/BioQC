<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioQC-benchmark: Testing Efficiency, Sensitivity and Specificity of BioQC on simulated and real-world data • BioQC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BioQC-benchmark: Testing Efficiency, Sensitivity and Specificity of BioQC on simulated and real-world data">
<meta property="og:description" content="BioQC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BioQC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.19.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/BioQC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bioqc-efficiency.html">BioQC Algorithm: Speeding up the Wilcoxon-Mann-Whitney Test</a>
    </li>
    <li>
      <a href="../articles/bioqc-introduction.html">BioQC: Detect tissue heterogeneity in gene expression data</a>
    </li>
    <li>
      <a href="../articles/bioqc-signedGenesets.html">Using BioQC with signed genesets</a>
    </li>
    <li>
      <a href="../articles/bioqc-simulation.html">BioQC-benchmark: Testing Efficiency, Sensitivity and Specificity of BioQC on simulated and real-world data</a>
    </li>
    <li>
      <a href="../articles/bioqc-wmw-test-performance.html">Comparing the Wilcoxon-Mann-Whitney to alternative statistical tests</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bioqc-simulation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BioQC-benchmark: Testing Efficiency, Sensitivity and Specificity of BioQC on simulated and real-world data</h1>
            
            <h4 class="date">2020-12-06</h4>
      
      
      <div class="hidden name"><code>bioqc-simulation.Rmd</code></div>

    </div>

    
    
<p>Supplementary Information for “Detect issue heterogenity in gene expression data with <a href="https://github.com/Accio/BioQC"><em>BioQC</em></a>” (<a href="mailto:jitao_david.zhang@roche.com">Jitao David Zhang</a>, Klas Hatje, Gregor Sturm, Clemens Broger, Martin Ebeling, Martine Burtin, Fabiola Terzi, Silvia Ines Pomposiello and <a href="mailto:laura.badi@roche.com">Laura Badi</a>)</p>
<p>In this vignette, we perform simulations with both model-generated and real-world data using <em>BioQC</em>. We show that <em>BioQC</em> is a sensitive method to detect tissue heterogeneity from high-throughput gene expression data. The source code used to produce this document can be found in the github repository <a href="https://github.com/Accio/BioQC-example">BioQC-example</a>.</p>
<p><em>BioQC</em> is a R/Bioconductor package to detect tissue heterogeneity from high-throughput gene expression profiling data. It implements an efficient Wilcoxon-Mann-Whitney test, and offers tissue-specific gene signatures that are ready to use ‘out of the box’.</p>
<div id="experiment-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#experiment-setup" class="anchor"></a>Experiment setup</h2>
<p>In this document, we perform two simulation studies with <em>BioQC</em>:</p>
<ul>
<li>
<strong>Sensitivity benchmark</strong> tests the sensitivity and specificity of <em>BioQC</em> detecting tissue heterogeneity using model-generated, simulated data;</li>
<li>
<strong>Mixing benchmark</strong> tests the sensitivity and specificity of <em>BioQC</em> using simulated contamination with real-world data.</li>
</ul>
<p>All source code that is needed to reproduce the results can be found in the <code>.Rmd</code> file generating this document.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://accio.github.io/BioQC">BioQC</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">hgu133plus2.db</span><span class="op">)</span> <span class="co">## to simulate an microarray expression dataset</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://latticeextra.r-forge.r-project.org/">latticeExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/talgalili/gplots">gplots</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.options.html">pdf.options</a></span><span class="op">(</span>family<span class="op">=</span><span class="st">"ArialMT"</span>, useDingbats<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1887</span><span class="op">)</span>

<span class="co">## list human genes</span>
<span class="va">humanGenes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">hgu133plus2SYMBOL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## read tissue-specific gene signatures</span>
<span class="va">gmtFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/exp.tissuemark.affy.roche.symbols.gmt"</span>,
                       package<span class="op">=</span><span class="st">"BioQC"</span><span class="op">)</span>
<span class="va">gmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readGmt.html">readGmt</a></span><span class="op">(</span><span class="va">gmtFile</span><span class="op">)</span>
<span class="va">tissueInds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">gmt</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">genes</span>, <span class="va">humanGenes</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="sensitivity-benchmark" class="section level2">
<h2 class="hasAnchor">
<a href="#sensitivity-benchmark" class="anchor"></a>Sensitivity Benchmark</h2>
<p>We next asked the question how sensitive <em>BioQC</em> is to expression changes of tissue signature genes. Similar to the previous simulation, we create random expression matrices. While keeping all other genes <span class="math inline">\(i.i.d\)</span> normally distributed following <span class="math inline">\(\mathcal{N}(0,1)\)</span>, we dedicatedly increase the expression of genes in one randomly selected tissue signature (ovary, with 43 genes) by different amplitudes: these genes’ expression levels are randomly drawn from different normal distributions with varying expectation and constant variance between <span class="math inline">\(\mathcal{N}(0,1)\)</span> and <span class="math inline">\(\mathcal{N}(3,1)\)</span>. To test the robustness of the algorithm, 10 samples are generated for each mean expression difference value.</p>
<div class="figure" style="text-align: center">
<img src="bioqc-simulation_files/figure-html/sensitivity_benchmark_fig-1.png" alt="**Figure 1:** Sensitivity benchmark. Expression levels of genes in the ovary signature are dedicately sampled randomly from normal distributions with different mean values. Left panel: enrichment scores reported by *BioQC* for the ovary signature, plotted against the differences in mean expression values; Right panel: rank of ovary enrichment scores in all 155 signatures plotted against the difference in mean expression values." width="768" style="display:block; margin: auto"><p class="caption">
<strong>Figure 1:</strong> Sensitivity benchmark. Expression levels of genes in the ovary signature are dedicately sampled randomly from normal distributions with different mean values. Left panel: enrichment scores reported by <em>BioQC</em> for the ovary signature, plotted against the differences in mean expression values; Right panel: rank of ovary enrichment scores in all 155 signatures plotted against the difference in mean expression values.
</p>
</div>
<p>The above figure visualizes the distribution of enrichment scores and their ranks dependent on the mean expression difference between ovary signature genes and background genes. As soon as the expression of signature genes increases by a very moderate ampltiude <span class="math inline">\(1\sigma\)</span>, <em>BioQC</em> will identify the gene set as the highest-ranking signature. A even stronger difference in expression will lead to higher enrichment scores but no change in the rank.</p>
<p>The results suggest that <em>BioQC</em> is sensitive even to moderate changes in the average expression of a gene set.</p>
</div>
<div id="mixing-benchmark" class="section level2">
<h2 class="hasAnchor">
<a href="#mixing-benchmark" class="anchor"></a>Mixing Benchmark</h2>
<p>The sensitivity benchmark above suffers from the limitation that the distributions of gene expression are not physiological. To overcome this, we designed and performed a benchmark by <em>in silico</em> mixing expression profiles with weighted linear combination, thereby mimicking tissue contamination.</p>
<p>Given the expression profile of a sample of tissue A (<span class="math inline">\(\mathbf{Y}_A\)</span>), and that of a sample of tissue B (<span class="math inline">\(\mathbf{Y}_B\)</span>), the weighted linear mixing produces a new profile <span class="math inline">\(\mathbf{Y}=\omega\mathbf{Y_A}+(1-\omega)\mathbf{Y_B}\)</span>, where <span class="math inline">\(\omega \in [0,1]\)</span>. In essence the profiles of two tissue types are linearly mixed in different proportions, which simulates varying severities of contaminations. We asked whether BioQC could detect such mixings, and if so, how sensitive is the method.</p>
<div id="dataset-selection-and-quality-control" class="section level3">
<h3 class="hasAnchor">
<a href="#dataset-selection-and-quality-control" class="anchor"></a>Dataset selection and quality control</h3>
<p>In order to avoid over-fitting of signatures derived from human expression data, we decided to use a normal tissue expression dataset from a non-human mammal species, because it has been shown that tissue-preferential expression patterns tend to be conserved between mammal species. We identified a dataset of <em>Canis lupus familiaris</em> (dog), which is publicly available in Gene Expression Omnibus (<a href="http://www.ncbi.nlm.nih.gov/sites/GDSbrowser?acc=GDS4164">GDS4164</a>).</p>
<p>In this study, the authors examined 39 samples from 10 pathologically normal tissues (liver, kidney, heart, lung, brain, lymph node, spleen, jejunum, pancreas, and skeletal muscle) of four dogs (with one pancreas sample missing). We downloaded the data, and performed minimal pre-processing: for multiple probesets that map to same genes, we kept the one with the highest average expression level and removed the rest. The resulting dataset contained expression of 16797 genes. BioQC was applied to the dataset to test whether there are major contamination issues. The results, including tissues reported by the authors, and the BioQC tissue signatures with the highest and second-highest scores, are reported in the following table:</p>
<table class="table">
<caption>Quality control of the mixing benchmark input data with <em>BioQC</em>. Four columns (f.l.t.r.): sample index; tissue reported by the authors; the tissue signature with the highest enrichment score reported by <em>BioQC</em>; the tissue signature with the second- highest enrichment score.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">Label</th>
<th align="left">BioQC.best</th>
<th align="left">BioQC.second</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">GSM502573</td>
<td align="left">Brain</td>
<td align="left">Spinal_cord</td>
<td align="left">Nodose_nucleus</td>
</tr>
<tr class="even">
<td align="left">GSM502574</td>
<td align="left">Brain</td>
<td align="left">Brain_Cortex_prefrontal</td>
<td align="left">Brain_Amygdala</td>
</tr>
<tr class="odd">
<td align="left">GSM502575</td>
<td align="left">Brain</td>
<td align="left">Brain_Cortex_prefrontal</td>
<td align="left">Brain_Amygdala</td>
</tr>
<tr class="even">
<td align="left">GSM502576</td>
<td align="left">Brain</td>
<td align="left">Brain_Cortex_prefrontal</td>
<td align="left">Brain_Amygdala</td>
</tr>
<tr class="odd">
<td align="left">GSM502577</td>
<td align="left">Heart</td>
<td align="left">Muscle_cardiac</td>
<td align="left">Muscle_skeletal</td>
</tr>
<tr class="even">
<td align="left">GSM502578</td>
<td align="left">Heart</td>
<td align="left">Muscle_cardiac</td>
<td align="left">Muscle_skeletal</td>
</tr>
<tr class="odd">
<td align="left">GSM502579</td>
<td align="left">Heart</td>
<td align="left">Muscle_cardiac</td>
<td align="left">Muscle_skeletal</td>
</tr>
<tr class="even">
<td align="left">GSM502580</td>
<td align="left">Heart</td>
<td align="left">Muscle_cardiac</td>
<td align="left">Muscle_skeletal</td>
</tr>
<tr class="odd">
<td align="left">GSM502581</td>
<td align="left">Jejunum</td>
<td align="left">Intestine_small</td>
<td align="left">Intestine_Colon</td>
</tr>
<tr class="even">
<td align="left">GSM502582</td>
<td align="left">Jejunum</td>
<td align="left">Intestine_small</td>
<td align="left">Intestine_Colon</td>
</tr>
<tr class="odd">
<td align="left">GSM502583</td>
<td align="left">Jejunum</td>
<td align="left">Intestine_small</td>
<td align="left">Intestine_Colon</td>
</tr>
<tr class="even">
<td align="left">GSM502584</td>
<td align="left">Jejunum</td>
<td align="left">Intestine_small</td>
<td align="left">Intestine_Colon</td>
</tr>
<tr class="odd">
<td align="left">GSM502585</td>
<td align="left">Kidney</td>
<td align="left">Kidney</td>
<td align="left">Kidney_Renal_Cortex</td>
</tr>
<tr class="even">
<td align="left">GSM502586</td>
<td align="left">Kidney</td>
<td align="left">Kidney</td>
<td align="left">Kidney_Renal_Cortex</td>
</tr>
<tr class="odd">
<td align="left">GSM502587</td>
<td align="left">Kidney</td>
<td align="left">Kidney</td>
<td align="left">Kidney_Renal_Cortex</td>
</tr>
<tr class="even">
<td align="left">GSM502588</td>
<td align="left">Kidney</td>
<td align="left">Kidney</td>
<td align="left">Kidney_Renal_Cortex</td>
</tr>
<tr class="odd">
<td align="left">GSM502589</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
</tr>
<tr class="even">
<td align="left">GSM502590</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
</tr>
<tr class="odd">
<td align="left">GSM502591</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
</tr>
<tr class="even">
<td align="left">GSM502592</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
<td align="left">Liver</td>
</tr>
<tr class="odd">
<td align="left">GSM502593</td>
<td align="left">Lung</td>
<td align="left">Lung</td>
<td align="left">Monocytes</td>
</tr>
<tr class="even">
<td align="left">GSM502594</td>
<td align="left">Lung</td>
<td align="left">Monocytes</td>
<td align="left">Lung</td>
</tr>
<tr class="odd">
<td align="left">GSM502595</td>
<td align="left">Lung</td>
<td align="left">Lung</td>
<td align="left">Monocytes</td>
</tr>
<tr class="even">
<td align="left">GSM502596</td>
<td align="left">Lung</td>
<td align="left">Monocytes</td>
<td align="left">Lung</td>
</tr>
<tr class="odd">
<td align="left">GSM502597</td>
<td align="left">LymphNode</td>
<td align="left">Lymphocyte_B_FOLL</td>
<td align="left">Lymphocytes_T_H</td>
</tr>
<tr class="even">
<td align="left">GSM502598</td>
<td align="left">LymphNode</td>
<td align="left">Lymphocyte_B_FOLL</td>
<td align="left">Lymphocytes_T_H</td>
</tr>
<tr class="odd">
<td align="left">GSM502599</td>
<td align="left">LymphNode</td>
<td align="left">Lymphocyte_B_FOLL</td>
<td align="left">Lymphocytes_T_H</td>
</tr>
<tr class="even">
<td align="left">GSM502600</td>
<td align="left">LymphNode</td>
<td align="left">Lymphocyte_B_FOLL</td>
<td align="left">Lymphocytes_T_H</td>
</tr>
<tr class="odd">
<td align="left">GSM502601</td>
<td align="left">Pancreas</td>
<td align="left">Pancreas_Islets</td>
<td align="left">Pancreas</td>
</tr>
<tr class="even">
<td align="left">GSM502602</td>
<td align="left">Pancreas</td>
<td align="left">Pancreas_Islets</td>
<td align="left">Pancreas</td>
</tr>
<tr class="odd">
<td align="left">GSM502603</td>
<td align="left">Pancreas</td>
<td align="left">Pancreas_Islets</td>
<td align="left">Pancreas</td>
</tr>
<tr class="even">
<td align="left">GSM502604</td>
<td align="left">SkeletalMuscle</td>
<td align="left">Muscle_skeletal</td>
<td align="left">Muscle_cardiac</td>
</tr>
<tr class="odd">
<td align="left">GSM502605</td>
<td align="left">SkeletalMuscle</td>
<td align="left">Muscle_skeletal</td>
<td align="left">Muscle_cardiac</td>
</tr>
<tr class="even">
<td align="left">GSM502606</td>
<td align="left">SkeletalMuscle</td>
<td align="left">Muscle_skeletal</td>
<td align="left">Muscle_cardiac</td>
</tr>
<tr class="odd">
<td align="left">GSM502607</td>
<td align="left">SkeletalMuscle</td>
<td align="left">Muscle_skeletal</td>
<td align="left">Muscle_cardiac</td>
</tr>
<tr class="even">
<td align="left">GSM502608</td>
<td align="left">Spleen</td>
<td align="left">Monocytes</td>
<td align="left">Lymphocyte_B_FOLL</td>
</tr>
<tr class="odd">
<td align="left">GSM502609</td>
<td align="left">Spleen</td>
<td align="left">Monocytes</td>
<td align="left">Lymphocyte_B_FOLL</td>
</tr>
<tr class="even">
<td align="left">GSM502610</td>
<td align="left">Spleen</td>
<td align="left">Monocytes</td>
<td align="left">Erythroid_cells</td>
</tr>
<tr class="odd">
<td align="left">GSM502611</td>
<td align="left">Spleen</td>
<td align="left">Monocytes</td>
<td align="left">Myeloblast</td>
</tr>
</tbody>
</table>
<p>By comparing the tissue labels provided by the authors and the predictions of <em>BioQC</em>, we notice that in most cases the two match well (despite of ontological differences). In three cases (sample ID GSM502573, GSM502594, and GSM502596) though, there seem to be intriguing differences, which might be explained by different sampling procedures or immune cell infiltration. We will however in this vignette not further explore them. These three samples are removed from the simulation procedures.</p>
</div>
<div id="an-example-of-weighted-mixing-heart-and-jejunum" class="section level3">
<h3 class="hasAnchor">
<a href="#an-example-of-weighted-mixing-heart-and-jejunum" class="anchor"></a>An example of weighted mixing: heart and jejunum</h3>
<p>As an example, we take average expression of heart and jejunum samples, and mix them by different compositions. This allows us comparing enrichment scores and their ranks when the expression profiles of heart and jejunum are mixed <em>in silico</em>:</p>
<div class="figure" style="text-align: center">
<img src="bioqc-simulation_files/figure-html/hjMixVis-1.png" alt="**Figure 2:** Results of a mixing case study. Left panel: *BioQC* enrichment scores of small intestine and cardiac muscle varying upon different proportions of jejunum; Right panel: ranks of enrichment scores varying upon different proportions of jejunum." width="768" style="display:block; margin: auto"><p class="caption">
<strong>Figure 2:</strong> Results of a mixing case study. Left panel: <em>BioQC</em> enrichment scores of small intestine and cardiac muscle varying upon different proportions of jejunum; Right panel: ranks of enrichment scores varying upon different proportions of jejunum.
</p>
</div>
<p>We observe that with as little as 5% contamination of heart tissue in jejunum samples (rightmost in the right panel), the rank of heart signature jumps from 34 to 9; 10% and 20% contamination will further enhance the rank to 4 and 3 respectively. If we start from the other end, namely assuming jejunum contamination in heart samples, the BioQC algorithms ranks jejunum the 7th only when there are more than 25% contamination. If we set enrichment score equal or over 3 as the threshold of calling a suspected contamination event (<span class="math inline">\(p&lt;0.001\)</span> in the one-sided Wilcoxon-Mann-Whitney test), it takes about 10% heart in jejunum tissue or about 30% jejunum tissue in heart to make a call. It means the sensitivity of contamination detection is not symmetric between tissues: contamination by tissues with distinct expression patterns (such as heart) are easier to be detected than contamination by tissues with less distinct expression patterns (such as small intestine).</p>
<p>While it is difficult to quantify the absolute sensitivity of contamination detection, it is apparent that if the enrichment score of a unforeseen tissue is very high (or ranked high), one may suspect potential contamination. Also, if there are replicates of samples from the same tissue, a higher value in one sample compared with the other samples suggests a contamination or infiltration incident.</p>
</div>
<div id="pairwise-mixing" class="section level3">
<h3 class="hasAnchor">
<a href="#pairwise-mixing" class="anchor"></a>Pairwise Mixing</h3>
<p>Following the heart-jejunum example, we performed all 45 pairwise mixing experiments, producing weighted linear combinations of gene expression profiles of each pair of tissues (excluding self-mixing). The results are summaried in a heatmap:</p>
<div class="figure" style="text-align: center">
<img src="bioqc-simulation_files/figure-html/dog_mix_vis-1.png" alt="**Figure 3:** Results of the pairwise mixing experiment. Each cell represents the minimal percentage of tissue of the column as contamination in the tissue of the row that can be detected by *BioQC*. No values are available for cells on the diagonal because self-mixing was excluded. Heart  and skeletal muscle are very close to each other and therefore their detection limit is not considered." width="768" style="display:block; margin: auto"><p class="caption">
<strong>Figure 3:</strong> Results of the pairwise mixing experiment. Each cell represents the minimal percentage of tissue of the column as contamination in the tissue of the row that can be detected by <em>BioQC</em>. No values are available for cells on the diagonal because self-mixing was excluded. Heart and skeletal muscle are very close to each other and therefore their detection limit is not considered.
</p>
</div>
<p>The heatmap visualization summarizes the detection limit of contamination of each pair of tissues. Take the cell in row 1 column 2 from top left: its value (0.15) means that if there are 15% or more contamination by heart in the brain sample, <em>BioQC</em> will be able to detect it (with the threshold enrichment score <span class="math inline">\(\geqslant3\)</span> or the rank <span class="math inline">\(\leqslant10\)</span>), because the enrichment score is equal to or larger than 3, or the heart tissue signature ranks in the top 10 of all tissue signatures.</p>
<p>Take another cell in row 2 column 1 from top left: its value (0.5) means that if there are 50% or more contanmination by brain in a heart sample, <em>BioQC</em> will be able to detect it. Here we observe the asymmetry again that we observed before with the heart/jejenum example: while it is realtively easy to identify heart contamination of a brain sample, it is more difficult to identify brain contamination of a heart sample in this dataset.</p>
<p>The average detection limits of tissues as contamination sources are listed in the following table. The values are derived from median values of each column in the heatmap, except for diagonal and missing elements.</p>
<table class="table">
<caption>Median lower detection limites of tissues as contamination sources.</caption>
<thead><tr class="header">
<th align="left">Tissue</th>
<th align="left">MedianDetectionLimit</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Brain</td>
<td align="left">52.22%</td>
</tr>
<tr class="even">
<td align="left">Heart</td>
<td align="left">10.62%</td>
</tr>
<tr class="odd">
<td align="left">Jejunum</td>
<td align="left">19.44%</td>
</tr>
<tr class="even">
<td align="left">Kidney</td>
<td align="left">23.75%</td>
</tr>
<tr class="odd">
<td align="left">Liver</td>
<td align="left">11.87%</td>
</tr>
<tr class="even">
<td align="left">Lung</td>
<td align="left">31.67%</td>
</tr>
<tr class="odd">
<td align="left">LymphNode</td>
<td align="left">30.63%</td>
</tr>
<tr class="even">
<td align="left">Pancreas</td>
<td align="left">17.22%</td>
</tr>
<tr class="odd">
<td align="left">SkeletalMuscle</td>
<td align="left">15.00%</td>
</tr>
<tr class="even">
<td align="left">Spleen</td>
<td align="left">13.57%</td>
</tr>
</tbody>
</table>
<p>Interestingly, brain samples are a special case: if they contaminate other tissues, it is more difficult to identify (but not other way around). It can be partially explained by the experiment design: Briggs <em>et al.</em> profiled the whole cerebrum, whereas in <em>BioQC</em> there are 22 distinct gene sets assigned to distinct brain regions. Though the prefrontal cortex signature scored highest in the canine brain samples, its score is relative low (7.45), and the genes in the signature are not too far away from the background genes:</p>
<div class="figure" style="text-align: center">
<img src="bioqc-simulation_files/figure-html/brain_low_exp-1.png" alt="**Figure 4:** Average expression of tissue-preferential genes in respective tissues. For each tissue (*e.g.* brain), we calculate the median ratio of gene expression level of specific genes over the median expression level of background genes. The value reflects the specificity of tissue-specific genes in respective tissues. Likely due to the sampling of different brain regions, the score of brain ranks the lowest." width="576" style="display:block; margin: auto"><p class="caption">
<strong>Figure 4:</strong> Average expression of tissue-preferential genes in respective tissues. For each tissue (<em>e.g.</em> brain), we calculate the median ratio of gene expression level of specific genes over the median expression level of background genes. The value reflects the specificity of tissue-specific genes in respective tissues. Likely due to the sampling of different brain regions, the score of brain ranks the lowest.
</p>
</div>
<p>Therefore only a strong contamination by brain in this dataset will be detected by the given threshold. We expect that if prefrontal cortex instead of cerebrum sample was profiled, the mixing profile of brain will be similar to other organs. This needs to be tested in other datasets.</p>
<p>Apart from that, most <em>in silico</em> contamination events are detectable in this dataset, with median detection limit around 0.2. This suggests that <em>BioQC</em> is sensitive towards tissue heterogeneity in physiological settings.</p>
</div>
</div>
<div id="conclusions" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusions" class="anchor"></a>Conclusions</h1>
<p>Benchmark studies with similated and real-world data demonstrate that <em>BioQC</em> is an efficient and sensitive method to detect tissue heterogeneity from high-throughput gene expression data.</p>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h1>
<div id="comparing-bioqc-with-principal-component-analysis-pca" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-bioqc-with-principal-component-analysis-pca" class="anchor"></a>Comparing BioQC with Principal Component Analysis (PCA)</h3>
<p>In the context of the dog transcriptome dataset, we can compare the results of principal component analysis (PCA) with that of <em>BioQC</em>:</p>
<div class="figure" style="text-align: center">
<img src="bioqc-simulation_files/figure-html/pca-1.png" alt="Sample separation revealed by principal component analysis (PCA) of the dog transcriptome dataset." width="576" style="display:block; margin: auto"><p class="caption">
Sample separation revealed by principal component analysis (PCA) of the dog transcriptome dataset.
</p>
</div>
<p>PCA sugggests that samples from each tissue tend to cluster together, in line with the <em>BioQC</em> results. In addition, PCA reveals that tissues with cells of similar origins cluster together, such as skeletal muscle and heart. As expected, one brain sample and two lung samples seem to be different from other samples of the same cluster, which are consistent with the <em>BioQC</em> findings; however, unlike BioQC, PCA does not provide information on what are potential contamination/infiltration casues.</p>
<p>Therefore, we believe <em>BioQC</em> complements existing unsupervised methods to inspect quality of gene expression data.</p>
</div>
<div id="r-session-info" class="section level2">
<h2 class="hasAnchor">
<a href="#r-session-info" class="anchor"></a>R Session Info</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R Under development (unstable) (2020-12-04 r79554)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats4    parallel  stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] gplots_3.1.1         gridExtra_2.3        latticeExtra_0.6-29 
##  [4] lattice_0.20-41      hgu133plus2.db_3.2.3 org.Hs.eg.db_3.12.0 
##  [7] AnnotationDbi_1.53.0 IRanges_2.25.4       S4Vectors_0.29.5    
## [10] BioQC_1.19.2         Biobase_2.51.0       BiocGenerics_0.37.0 
## [13] knitr_1.30          
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.5         highr_0.8          RColorBrewer_1.1-2 compiler_4.1.0    
##  [5] bitops_1.0-6       tools_4.1.0        digest_0.6.27      bit_4.0.4         
##  [9] gtable_0.3.0       evaluate_0.14      memoise_1.1.0      RSQLite_2.2.1     
## [13] png_0.1-7          pkgconfig_2.0.3    rlang_0.4.9        DBI_1.1.0         
## [17] yaml_2.2.1         pkgdown_1.6.1.9000 xfun_0.19          stringr_1.4.0     
## [21] caTools_1.18.0     gtools_3.8.2       desc_1.2.0         fs_1.5.0          
## [25] vctrs_0.3.5        systemfonts_0.3.2  locfit_1.5-9.4     rprojroot_2.0.2   
## [29] bit64_4.0.5        grid_4.1.0         R6_2.5.0           jpeg_0.1-8.1      
## [33] textshaping_0.2.1  rmarkdown_2.5      limma_3.47.1       blob_1.2.1        
## [37] edgeR_3.33.0       magrittr_2.0.1     htmltools_0.5.0    assertthat_0.2.1  
## [41] ragg_0.4.0         KernSmooth_2.23-18 stringi_1.5.3      crayon_1.3.4</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jitao David Zhang, Laura Badi, Gregor Sturm, Roland Ambs, Iakov Davydov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
